"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var throttle=function(e,t){var n;return function(){var a=this,r=arguments,o=function(){n=!1};n||(e.apply(a,r),n=!0,setTimeout(o,t))}},useMedia=function(e,t){t&&"function"==typeof t||console.error("Must be a function");var n=window.matchMedia(e).matches,a=window.matchMedia(e);return a.addListener(t),t(a),n},polyfill=(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),void(Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null}))),$=function(e){return document.querySelector(e)},$$=function(e){return document.querySelectorAll(e)},transitionCollapse=!1,transitionExpand=!1,setMedia=null,allHoverElements=[],tHandler=null,eventType=null,isActive=null,tabbableBreadcrumb=[],focusable=null,ENTER_KEY_CODE="Enter",UP_KEY_CODE="ArrowDown",DOWN_KEY_CODE="ArrowUp",TAB_KEY_CODE="Tab",SHIFT_KEY_CODE=16,ESCAPE_KEY_CODE="Escape",focusableAll='a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, [tabindex="0"], [contenteditable], audio[controls], video[controls], summary',keyEvents=function(e){var t=e.code;return t===UP_KEY_CODE||t===DOWN_KEY_CODE||t===TAB_KEY_CODE||t===ESCAPE_KEY_CODE||t===SHIFT_KEY_CODE},matchMedia=function(e){var t=e.matches;!t||!1!==isActive&&null!==isActive||(isActive=!0,checkEvent()),t||!0!==isActive&&null!==isActive||(isActive=!1,checkEvent())},detectMouse=function(e){return function(t){null!==eventType&&eventType===t.pointerType&&isActive&&"touch"===eventType||!isActive&&"mouse"===eventType||(eventType=isActive?"touch":t.pointerType,e(eventType),document.removeEventListener("pointerover",tHandler,!1))}},checkEvent=function(){document.addEventListener("pointerover",tHandler,!1)};function handleHover(e,t,n,a){allHoverElements=[].slice.call($$(e)),tHandler=throttle(detectMouse(a),100),checkEvent(),(setMedia=useMedia(t,n))&&(isActive=!0)}var animationExist=function(e){var t=window.getComputedStyle(e.value,null),n=t.getPropertyValue("transition-duration"),a=t.getPropertyValue("transition-property");return{exist:"drop"===e.type&&"0s"!==n,animation:a}},isOutOfViewport=function(e){var t=e.getBoundingClientRect(),n={};return n.top=t.top<0,n.left=t.left<0,n.bottom=t.bottom>(window.innerHeight||document.documentElement.clientHeight),n.right=t.right>(window.innerWidth||document.documentElement.clientWidth),n.any=n.top||n.left||n.bottom||n.right,n.all=n.top&&n.left&&n.bottom&&n.right,n},getNextSibling=function(e,t){var n=e.nextElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}},isTabActive=function(e,t,n){return e===t||e===$(t.getAttribute(n))},createElementObject=function(e,t,n,a,r,o,i,l){var s=t.classList.contains(a),c=!!t.hasAttribute(l)&&t.hasAttribute(l);return{type:e,value:t,role:n||"default",active:s,isAnimate:"drop"===e&&c,eventType:r,tabActive:"tab"===n&&s&&isTabActive(t,o,i)}},getGrouped=function(e,t,n,a,r,o,i,l,s){return[].slice.call($$("[".concat(o,'="').concat(n,'"]'))).filter((function(n){return n!==e&&n.classList.contains(t)})).reduce((function(n,o){var c=l?getNextSibling(o,o.getAttribute(r)):$(o.getAttribute(r)),u=createElementObject("toggle",o,a,t,i,e,r),d=createElementObject("drop",c,a,t,i,e,r,s);return[].concat(_toConsumableArray(n),[u,d])}),[])},getToggles=function(e,t,n,a,r,o,i,l){return r?[createElementObject("toggle",e,a,t,i,e,o)]:[].slice.call($$("[".concat(o,'="').concat(n,'"]'))).map((function(n){return createElementObject("toggle",n,a,t,i,e,o)}))},getDrops=function(e,t,n,a,r,o,i,l){return r?[createElementObject("drop",getNextSibling(e,n),a,t,i,e,o,l)]:[].slice.call($$(n)).map((function(n){return createElementObject("drop",n,a,t,i,e,o,l)}))},animateDefault=function(e,t,n,a,r){function o(t){e.value.removeEventListener("transitionend",o),e.value.classList.remove(n),transitionCollapse=!1}function i(t){e.value.removeEventListener("transitionend",i),transitionExpand=!1,e.value.enterLocked=!1,tabbableBreadcrumb.length>0&&checkTabbable(e)&&createFocusable(r)}a===enter||a!==enter&&!e.active?function(e){transitionExpand=!0,e.value.removeAttribute("data-toggle-hidden",!0),window.requestAnimationFrame((function(){e.value.classList.add(n),window.requestAnimationFrame((function(){e.value.classList.add(t),e.value.addEventListener("transitionend",i)}))}))}(e):(a===leave||a!==enter&&e.active)&&function(e){"tab"===e.role?(e.value.classList.remove(t),e.value.classList.remove(n)):(e.value.setAttribute("data-toggle-hidden",!0),e.value.addEventListener("transitionend",o),e.value.classList.remove(t),transitionCollapse=!0)}(e)},animateHeight=function(e,t,n,a){function r(t){t.target.removeEventListener("transitionend",r),l(t.target),tabbableBreadcrumb.length>0&&checkTabbable(e)&&createFocusable(a)}function o(e){e.target.removeEventListener("transitionend",o),i(e.target)}var i=function(e){e.classList.remove(t),e.classList.remove(n),e.style.height=null,transitionCollapse=!1},l=function(e){e.classList.remove(t),e.style.height=null,transitionExpand=!1};return e.active?function(e){transitionCollapse=!0;var n=e.value.scrollHeight;e.value.setAttribute("data-toggle-hidden",!0),window.requestAnimationFrame((function(){e.value.style.height=n+"px",e.value.classList.add(t),window.requestAnimationFrame((function(){e.value.addEventListener("transitionend",o),e.value.style.height="0px"}))}))}(e):function(e){transitionExpand=!0,e.value.classList.add(n),e.value.classList.add(t);var a=e.value.scrollHeight;e.value.style.height=a+"px",e.value.removeAttribute("data-toggle-hidden",!0),e.value.addEventListener("transitionend",r)}(e)},setPosition=function(e){if("toggle"!==e.type){e.value.setAttribute("style","position: absolute; visibility: hidden; display: block; pointer-events: none"),e.value.classList.remove("is--position-bottom","is--position-top","is--position-left","is--position-right");var t=isOutOfViewport(e.value);e.value.removeAttribute("style"),t.top&&(e.value.classList.add("is--position-bottom"),e.value.classList.remove("is--position-top")),t.bottom&&(e.value.classList.add("is--position-top"),e.value.classList.remove("is--position-bottom")),t.left&&(e.value.classList.add("is--position-left"),e.value.classList.remove("is--position-right")),t.right&&(e.value.classList.add("is--position-right"),e.value.classList.remove("is--position-left"))}},_ref2=window.PointerEvent?{end:"pointerup",enter:"pointerenter",leave:"pointerleave"}:{end:"touchend",enter:"mouseenter",leave:"mouseleave"},enter=_ref2.enter,leave=_ref2.leave,mouseEvents=[enter,leave],getEventTarget=function(e,t,n){return{item:e.querySelector(n),type:t}},checkValidity=function(e,t,n){var a=!("drop"!==e.type||!e.value.hasAttribute(t))&&e.value.querySelectorAll("[required]");if(!a)return!1;if(a){var r=0!==[].slice.call(a).filter((function(e){return!e.checkValidity()})).length&&r;return r?(r[0].focus(),r[0].classList.add(n),setTimeout((function(){var e=r[0].getBoundingClientRect().top;window.scrollBy({top:e,left:0,behavior:"smooth"})}),250),!0):(a.forEach((function(e){return e.classList.contains(n)&&e.classList.remove(n)})),!1)}},isHidden=function e(t){var n=window.getComputedStyle(t);return"none"!==n.display&&"hidden"!==n.visibility&&(!t.parentElement||e(t.parentElement))},addTabbable=function(e,t,n,a){if(tabbableBreadcrumb.forEach((function(e){return e.element.classList.contains(a)&&e.element.classList.remove(a)})),tabbableBreadcrumb.length>0&&!tabbableBreadcrumb[0].element.contains(t))for(var r=0;r<tabbableBreadcrumb.length;r++)tabbableBreadcrumb.pop();if(e.active){if(e.active)for(r=0;r<tabbableBreadcrumb.length;r++)if(tabbableBreadcrumb[r].element===e.value){1===tabbableBreadcrumb.length&&tabbableBreadcrumb[0].element.removeEventListener("keydown",n),tabbableBreadcrumb.splice(r,1);break}}else{var o={active:t,element:e.value};tabbableBreadcrumb.push(o)}},createFocusable=function(e){var t=tabbableBreadcrumb.length;tabbableBreadcrumb[t-1].element.classList.add(e),(focusable=[].slice.call(tabbableBreadcrumb[0].element.querySelectorAll(focusableAll)).filter((function(e){return isHidden(e)}))).unshift(tabbableBreadcrumb[0].active),1===t&&focusable[1].focus()},checkTabbable=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.eventType;return("click"===t||"keydown"===t)&&"drop"===e.type&&"tab"!==e.role&&"accordion"!==e.role},defaultConfig={selectorToggle:"[data-toggle]",selectorGlobal:"[data-toggle-global]",selectorGroup:"[data-toggle-group]",selectorValidate:"[data-toggle-validate]",selectorRole:"[data-toggle-role]",selectorBack:"[data-toggle-back]",selectorNext:"[data-toggle-next]",selectorAnimate:"[data-toggle-animate]",selectorHover:"[data-toggle-hover]",toggleActiveClass:"is--active",toggleErrorClass:"is--error",toggleCollapseClass:"is--collapsing",toggleShowClass:"is--show",toggleCurrentClass:"is--current",onHover:!1,onnHoverMediaQuery:"(max-width: 992px)",stopVideo:!0,callbackOpen:!1,callbackClose:!1,callbackToggle:!1},Toggle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread2({},defaultConfig,{},e),n=t.selectorToggle,a=t.selectorGlobal,r=t.selectorGroup,o=t.selectorValidate,i=t.selectorRole,l=t.selectorBack,s=t.selectorNext,c=t.selectorAnimate,u=t.selectorHover,d=t.toggleActiveClass,v=t.toggleErrorClass,b=t.toggleCollapseClass,p=t.toggleShowClass,m=t.toggleCurrentClass,g=t.onHover,f=t.onnHoverMediaQuery,E=(t.stopVideo,t.callbackOpen),h=t.callbackClose,y=t.callbackToggle,A=t.splitselectorToggle,L=void 0===A?n.replace(/\[|\]/g,""):A,w=t.splitselectorValidate,C=void 0===w?o.replace(/\[|\]/g,""):w,O=t.splitselectorGroup,_=void 0===O?r.replace(/\[|\]/g,""):O,T=t.splitselectorAnimate,k=void 0===T?c.replace(/\[|\]/g,""):T,D=t.splitselectorHover,S=void 0===D?u.replace(/\[|\]/g,""):D,x=t.splitselectorRole,B=void 0===x?i.replace(/\[|\]/g,""):x,H=t.splitselectorBack,P=(void 0===H&&l.replace(/\[|\]/g,""),$("body")),j=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),K=function(){Y(),j&&P.classList.add("is--ios"),g&&handleHover(u,f,matchMedia,q),M()},Y=function(){j&&P.classList.remove("is--ios"),document.removeEventListener("click",N,!1),document.removeEventListener("keydown",G,!1),g&&isActive&&allHoverElements.map((function(e){mouseEvents.map((function(t){e.removeEventListener(t,V)}))}))},M=function(){document.addEventListener("click",N,!1),document.addEventListener("keydown",G,!1)},N=function(e){"mouseover"===eventType&&e.target.parentElement.hasAttribute(S)||(e.target.closest(n)||e.target.closest(l)?(e.preventDefault(),transitionExpand||transitionCollapse||R(e)):z(e))};function V(e){if(e.target.matches(u)&&(e.type===enter&&(this.enterLocked=!0),this.enterLocked||e.type!==enter)){var t=getEventTarget(e.target,e.type,n);R(t)}}var q=function(e){"touch"===e&&allHoverElements.map((function(e){e.removeEventListener(enter,V,!1),e.removeEventListener(leave,V,!1)})),"mouse"===e&&allHoverElements.map((function(e){e.addEventListener(enter,V,!1),e.addEventListener(leave,V,!1)}))},F=function(e){return!e.target.closest(n)||!e.target.closest(u)||e.code!==ENTER_KEY_CODE},G=function(e){transitionExpand||transitionCollapse||F(e)&&!keyEvents(e)||(F?keyEvents(e)&&tabbableBreadcrumb.length>0&&Q(e):(e.preventDefault(),R(e)))},R=function(e){var t=e.target?e.target.closest(n)||e.target.closest(l).parentNode.parentNode.querySelector(n):e.item,a=!!e.type&&e.type;y&&y(t);var r=t.getAttribute(L),o=t.getAttribute(_),i=t.getAttribute(B),c=t.closest(s),u=o?getGrouped(t,d,o,i,L,_,a,c,k):[],p=getToggles(t,d,r,i,c,L,a),m=getDrops(t,d,r,i,c,L,a,k),g=[].concat(_toConsumableArray(u),_toConsumableArray(p),_toConsumableArray(m));if(!p[0].tabActive){var f=g.filter((function(e){return e.active&&"drop"===e.type&&e.value.hasAttribute(C)}));if(f)if(checkValidity(f,C,v))return;var E=!0,h=!1,A=void 0;try{for(var w,O=g[Symbol.iterator]();!(E=(w=O.next()).done);E=!0){var T=w.value;W(T,b,d,a,t)}}catch(e){h=!0,A=e}finally{try{E||null==O.return||O.return()}finally{if(h)throw A}}}},W=function(e,t,n,a,r){var o=e.isAnimate,i=animationExist(e),l=i.exist,s=i.animation.match(/height/gi);checkTabbable(e,a)&&addTabbable(e,r,Q,m),o&&s?animateHeight(e,t,n,m):o&&l?animateDefault(e,p,n,a,m):e.active?U(e):I(e)},I=function(e){E&&E(e),"tooltip"===e.role&&setPosition(e),e.value.classList.add(d),"toggle"===e.type&&e.value.setAttribute("aria-expanded",!0),"drop"===e.type&&e.value.removeAttribute("data-toggle-hidden",!0),tabbableBreadcrumb.length>0&&checkTabbable(e)&&createFocusable(m)},U=function(e){h&&h(e),e.value.classList.remove(d),"toggle"===e.type&&e.value.setAttribute("aria-expanded",!1),"drop"===e.type&&e.value.setAttribute("data-toggle-hidden",!0)},Q=function(e){var t={item:tabbableBreadcrumb[0].active,type:e.type},n=focusable[1],a=focusable[focusable.length-1];e.code===TAB_KEY_CODE?e.shiftKey?document.activeElement===n&&R(t):document.activeElement===a&&R(t):e.code===UP_KEY_CODE&&document.activeElement===n?(e.preventDefault(),a.focus()):e.code===DOWN_KEY_CODE&&document.activeElement===a?(e.preventDefault(),n.focus()):e.code===ESCAPE_KEY_CODE&&(focusable[0].focus(),R(t))},z=function(e){var t=[].slice.call($$("".concat(a,".").concat(d)));if(0!==t.length&&null===e.target.closest(t[0].getAttribute(L))){var n=t.map((function(e){return $("".concat(e.getAttribute(L),".").concat(d))}));t.forEach((function(e){return e.classList.remove(d)})),n.forEach((function(e){null!==e&&(e.classList.remove(d),e.classList.contains(p)&&e.classList.remove(p))}))}};K()};module.exports=Toggle;
