"use strict";function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(n,!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var start,end,throttle=function(e,t){var n;return function(){var o=this,i=arguments,a=function(){n=!1};n||(e.apply(o,i),n=!0,setTimeout(a,t))}},useMedia=function(e,t){t&&"function"==typeof t||console.error("Must be a function");var n=window.matchMedia(e).matches,o=window.matchMedia(e);return o.addListener(t),t(o),n},$=function(e){return document.querySelector(e)},$$=function(e){return document.querySelectorAll(e)},transitionCollapse=!1,transitionExpand=!1,setMedia=null,mouseEvents=["mouseenter","mouseleave"],ENTER_KEY_CODE=13;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var animationExist=function(e){var t=window.getComputedStyle(e.value,null).getPropertyValue("transition-duration");return"drop"===e.type&&"0s"!==t},isOutOfViewport=function(e){var t=e.getBoundingClientRect(),n={};return n.top=t.top<0,n.left=t.left<0,n.bottom=t.bottom>(window.innerHeight||document.documentElement.clientHeight),n.right=t.right>(window.innerWidth||document.documentElement.clientWidth),n.any=n.top||n.left||n.bottom||n.right,n.all=n.top&&n.left&&n.bottom&&n.right,n},getNextSibling=function(e,t){var n=e.nextElementSibling;if(!t)return n;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}},isTabActive=function(e,t,n){return e===t||e===$(t.getAttribute(n))},createElementObject=function(e,t,n,o,i,a,r,l){var s=!!t.hasAttribute(i)&&t.getAttribute(i),c=(null===a||!t.classList.contains(o))&&t.classList.contains(o);return{type:e,value:t,role:n||"default",active:c,isAnimateHeight:"drop"===e&&"height"===s,isAnimate:"drop"===e&&"default"===s,tabActive:"tab"===n&&c&&isTabActive(t,r,l)}},getGrouped=function(e,t,n,o,i,a,r,l,s){return[].slice.call($$("[".concat(r,'="').concat(o,'"]'))).filter(function(n){return n!==e&&n.classList.contains(t)}).reduce(function(o,r){var l=s?getNextSibling(r,r.getAttribute(a)):$(r.getAttribute(a)),c=createElementObject("toggle",r,i,t,null,null,e,a),u=createElementObject("drop",l,i,t,n,null,e,a);return[].concat(_toConsumableArray(o),[c,u])},[])},getToggles=function(e,t,n,o,i,a,r,l){return i?[createElementObject("toggle",e,o,t,null,r)]:[].slice.call($$("[".concat(a,'="').concat(n,'"]'))).map(function(n){return createElementObject("toggle",n,o,t,null,r,e,a)})},getDrops=function(e,t,n,o,i,a,r,l){return a?[createElementObject("drop",getNextSibling(e,o),i,t,n,l)]:[].slice.call($$(o)).map(function(o){return createElementObject("drop",o,i,t,n,l,e,r)})},animateHeight=function(e,t,n){function o(e){e.target.removeEventListener("transitionend",o),r(e.target)}function i(e){e.target.removeEventListener("transitionend",i),a(e.target)}var a=function(e){e.classList.remove(t),e.classList.remove(n),e.style.height=null,transitionCollapse=!1},r=function(e){e.classList.remove(t),e.style.height=null,transitionExpand=!1};return e.active?function(e){transitionCollapse=!0;var n=e.value.scrollHeight;window.requestAnimationFrame(function(){e.value.style.height=n+"px",e.value.classList.add(t);var o=animationExist(e);window.requestAnimationFrame(function(){o?e.value.addEventListener("transitionend",i):a(e.value),e.value.style.height="0px"})})}(e):function(e){transitionExpand=!0,e.value.classList.add(n),e.value.classList.add(t);var i=e.value.scrollHeight;e.value.style.height=i+"px",animationExist(e)?e.value.addEventListener("transitionend",o):r(e.value)}(e)},animateDefaultCollapse=function(e,t,n){var o=animationExist(e);console.log("collapse ",e);function i(t){console.log("collapse ",t.target),e.value.removeEventListener("transitionend",i),e.value.classList.remove(n),transitionCollapse=!1}o?function(e){"tab"===e.role?(e.value.classList.remove(t),e.value.classList.remove(n)):(transitionCollapse=!0,e.value.classList.remove(t),e.value.addEventListener("transitionend",i))}(e):function(e){e.value.classList.remove(t),e.value.classList.remove(n),transitionCollapse=!1}(e)},animateDefaultExpand=function(e,t,n){function o(t){e.value.removeEventListener("transitionend",o),transitionExpand=!1}animationExist(e)?function(e){transitionExpand=!0,window.requestAnimationFrame(function(){e.value.classList.add(n),window.requestAnimationFrame(function(){e.value.classList.add(t),e.value.addEventListener("transitionend",o)})})}(e):function(e){e.value.classList.add(n),e.value.classList.add(t),transitionExpand=!1}(e)},setPosition=function(e){if("toggle"!==e.type){e.value.setAttribute("style","position: absolute; visibility: hidden; display: block; pointer-events: none"),e.value.classList.remove("is--position-bottom","is--position-top","is--position-left","is--position-right");var t=isOutOfViewport(e.value);e.value.removeAttribute("style"),t.top&&(e.value.classList.add("is--position-bottom"),e.value.classList.remove("is--position-top")),t.bottom&&(e.value.classList.add("is--position-top"),e.value.classList.remove("is--position-bottom")),t.left&&(e.value.classList.add("is--position-left"),e.value.classList.remove("is--position-right")),t.right&&(e.value.classList.add("is--position-right"),e.value.classList.remove("is--position-left"))}},getEventTarget=function(e,t,n){return{item:e.querySelector(n),active:"mouseenter"===t||null}},defaultConfig={selectorToggle:"[data-toggle]",selectorGlobal:"[data-toggle-global]",selectorGroup:"[data-toggle-group]",selectorValidate:"[data-toggle-validate]",selectorRole:"[data-toggle-role]",selectorBack:"[data-toggle-back]",selectorNext:"[data-toggle-next]",selectorAnimate:"[data-toggle-animate]",selectorHover:"[data-toggle-hover]",toggleActiveClass:"is--active",toggleErrorClass:"is--error",toggleCollapseClass:"is--collapsing",toggleShowClass:"is--show",onHover:!1,onnHoverMediaQuery:"(max-width: 992px)",stopVideo:!0,callbackOpen:!1,callbackClose:!1,callbackToggle:!1},Toggle=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=_objectSpread2({},defaultConfig,{},e),n=t.selectorToggle,o=t.selectorGlobal,i=t.selectorGroup,a=t.selectorValidate,r=t.selectorRole,l=t.selectorBack,s=t.selectorNext,c=t.selectorAnimate,u=t.selectorHover,v=t.toggleActiveClass,d=t.toggleErrorClass,p=t.toggleCollapseClass,g=t.toggleShowClass,m=t.onHover,f=t.onnHoverMediaQuery,b=(t.stopVideo,t.callbackOpen),h=t.callbackClose,y=t.callbackToggle,E=t.splitselectorToggle,L=void 0===E?n.replace(/\[|\]/g,""):E,w=t.splitselectorValidate,A=void 0===w?a.replace(/\[|\]/g,""):w,C=t.splitselectorGroup,O=void 0===C?i.replace(/\[|\]/g,""):C,x=t.splitselectorAnimate,S=void 0===x?c.replace(/\[|\]/g,""):x,j=t.splitselectorHover,T=void 0===j?u.replace(/\[|\]/g,""):j,k=t.splitselectorRole,_=void 0===k?r.replace(/\[|\]/g,""):k,H=t.splitselectorBack,P=(void 0===H&&l.replace(/\[|\]/g,""),[]),D=null,M=null,q=null,N=$("body"),V=!!navigator.userAgent.match(/(iPad|iPhone|iPod)/g),G=function(){R(),V&&N.classList.add("is--ios"),m&&(P=[].slice.call($$(u)),D=throttle(F,100),I(),(setMedia=useMedia(f,K))&&(q=!0)),B()},R=function(){V&&N.classList.remove("is--ios"),document.removeEventListener("click",W,!1),m&&q&&P.map(function(e){mouseEvents.map(function(t){e.removeEventListener(t,Y)}),e.removeEventListener("keydown",z)})},B=function(){document.addEventListener("click",W,!1)},K=function(e){var t=e.matches;!t||!1!==q&&null!==q||(q=!0,I()),t||!0!==q&&null!==q||(q=!1,I())},F=function(e){null!==M&&M===e.type&&q&&"touchstart"===M||!q&&M===e.type||(M=q?"touchstart":e.type,Q(M),["mouseover"].map(function(e){document.removeEventListener(e,D,!1)}))},I=function(){["touchstart","mouseover"].map(function(e){document.addEventListener(e,D,!1)})},W=function(e){start=performance.now(),"mouseover"===M&&e.target.parentElement.hasAttribute(T)||(e.target.closest(n)||e.target.closest(l)?(e.preventDefault(),transitionExpand||transitionCollapse||J(e)):ee(e))},Q=function(e){"touchstart"===e&&P.map(function(e){mouseEvents.map(function(t){e.removeEventListener(t,Y)}),e.removeEventListener("keydown",z)}),"mouseover"===e&&P.map(function(e){mouseEvents.map(function(t){e.addEventListener(t,Y)}),e.addEventListener("keydown",z)})},Y=function(e){if(e.target.matches(u)){start=performance.now();var t=getEventTarget(e.target,e.type,n);J(t)}},z=function(e){e.keyCode===ENTER_KEY_CODE&&(transitionExpand||transitionCollapse||(e.preventDefault(),J(e)))},J=function(e){var t=e.target?e.target.closest(n)||e.target.closest(l).parentNode.parentNode.querySelector(n):e.item,o=e.active?e.active:null;y&&y(t);var i=t.getAttribute(L),a=t.getAttribute(O),r=t.getAttribute(_),c=t.closest(s),u=a?getGrouped(t,v,S,a,r,L,O,o,c):[],d=getToggles(t,v,i,r,c,L,o),m=getDrops(t,v,S,i,r,c,L,o);[].concat(_toConsumableArray(u),_toConsumableArray(d),_toConsumableArray(m)).forEach(function(e){var t=e.active,n=e.isAnimateHeight,o=e.isAnimate;if(!e.tabActive){if(t)if(Z(e))return;n?animateHeight(e,p,v):o?e.active?animateDefaultCollapse(e,g,v):animateDefaultExpand(e,g,v):e.active?X(e):U(e)}}),end=performance.now(),console.log("toggleItem -> "+(end-start)+" ms.")},U=function(e){b&&b(e),"tooltip"===e.role&&setPosition(e),e.value.classList.add(v),"toggle"===e.type&&e.value.setAttribute("aria-expanded",!0),end=performance.now(),console.log("open -> "+(end-start)+" ms.")},X=function(e){h&&h(e),e.value.classList.remove(v),"toggle"===e.type&&e.value.setAttribute("aria-expanded",!1),end=performance.now(),console.log("close -> "+(end-start)+" ms.")},Z=function(e){var t=!("drop"!==e.type||!e.value.hasAttribute(A))&&e.value.querySelectorAll("[required]");if(!t)return!1;if(t){var n=0!==[].slice.call(t).filter(function(e){return!e.checkValidity()}).length&&n;return n?(n[0].focus(),n[0].classList.add(d),setTimeout(function(){var e=n[0].getBoundingClientRect().top;window.scrollBy({top:e,left:0,behavior:"smooth"})},250),!0):(t.forEach(function(e){return e.classList.contains(d)&&e.classList.remove(d)}),!1)}},ee=function(e){var t=[].slice.call($$("".concat(o,".").concat(v)));if(0!==t.length&&null===e.target.closest(t[0].getAttribute(L))){var n=t.map(function(e){return $("".concat(e.getAttribute(L),".").concat(v))});t.forEach(function(e){return e.classList.remove(v)}),n.forEach(function(e){e.classList.remove(v),e.classList.contains(g)&&e.classList.remove(g)})}};G()};module.exports=Toggle;
